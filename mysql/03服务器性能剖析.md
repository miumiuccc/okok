
服务器性能剖析    

3.1性能优化简介    
我们将性能定义为完成某件任务所需要的时间度量,即响应时间.    
数据库服务器的性能用查询的响应时间来度量,单位是每个查询花费的时间.    
性能优化:在一定的工作负载下尽可能降低响应时间    

性能解析2个步骤:    
1.测试任务所花费时间    
2.对结果进行统计和排序,将重要的任务排到前面    


3.2对应用程序进行性能剖析    
推荐工具:    
New Relic    
可以全天候测量生产环境的代码    

xhprof    
易于安装使用,轻量级,可扩展性好,可以在生产环境大量部署并全天候使用    

xdebug,valgrind,cachegrind    
大量输出,开销大,不适合在生产环境,可以在开发环境使用    



3.3剖析MySQL查询    

慢查询日志:                         mysql 慢查询(学习)    
开销最低,精度最高的测量查询事件的工具    
可以设置long_query_time为0捕获所有的查询    
如果长期开启慢查询日志,注意要部署日志轮转(log rotation)工具    

分析查询日志:    
可以在一些点心的时间窗口,例如业务高峰期的一个小时内记录查询    
不要直接打开整个慢查询日志进行分析,这样只会浪费时间    
慢查询日志生成剖析报告的工具:建议pt-query-digest    


剖析单挑查询:    
1.使用 show profile    

默认为0,不记录,需要开启:    
set profiling = 1;    

数据库查询:eg.    
select * from shop_admin;    

查看所有查询列表:    
show profiles    

对id为3的查询查看详细:    
show profile for query 3;    

2.使用 show status    
3.使用 慢查询日志    
4.使用 Performance Schema    



3.4诊断间歇性问题    
3.5其他剖析工具    